# --------------------------------------------------------------------------
# RetExpert: A Test-time Clinically Adaptive Framework for Retinal Disease Detection
#
# Official Implementation of the Paper:
# "RetExpert: A test-time clinically adaptive framework for detecting multiple 
#  fundus diseases by harnessing ophthalmic foundation models"
#
# Authors: Hongyang Jiang, Zirong Liu, et al.
# Copyright (c) 2025 The Chinese University of Hong Kong & Wenzhou Medical University.
#
# Licensed under the MIT License.
# --------------------------------------------------------------------------

# utils/constants.py
import torch

# Definition of Fundus Disease Co-occurrence Matrix (FDCM)
# Coefficients based on Table 1 in the paper:
# Complete (1.0), High (0.75), Moderate (0.5), Low (0.25), Minimal (0.0)

# MuReD Dataset (20 classes)
MURED_FDCM = torch.tensor([
            [1, 0, 0.5, 0.25, 0.25, 0.5, 0.5, 0.5, 0.5, 0.25, 0.5, 0.25, 0.25, 0.5, 0.75, 0.25, 0.75, 0.75, 0.25, 0.5],         #DR
            [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],                                                       #NORMAL
            [0.5, 0, 1, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.5, 0.5, 0.5, 0.25, 0.25, 0.25, 0.25, 0.5],      #MH    
            [0.25, 0, 0.25, 1, 0.5, 0.25, 0.25, 0.5, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.5, 0.25, 0.25, 0.5],     #ODC
            [0.25, 0, 0.25, 0.5, 1, 0.5, 0.5, 0.75, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.5],     #TSLN
            [0.5, 0, 0.25, 0.25, 0.5, 1, 0.75, 0.5, 0.5, 0.25, 0.5, 0.75, 0.25, 0.25, 0.5, 0.25, 0.75, 0.5, 0.25, 0.5],         #AMD
            [0.5, 0, 0.25, 0.25, 0.5, 0.75, 1, 0.5, 0.25, 0.25, 0.5, 0.75, 0.25, 0.25, 0.5, 0.25, 0.5, 0.5, 0.25, 0.5],         #DN
            [0.5, 0, 0.25, 0.5, 0.75, 0.5, 0.5, 1, 0.25, 0.25, 0.5, 0.5, 0.25, 0.25, 0.5, 0.25, 0.5, 0.25, 0.25, 0.5],          #MYA
            [0.5, 0, 0.25, 0.25, 0.25, 0.5, 0.25, 0.25, 1, 0.5, 0.75, 0.25, 0.25, 0.25, 0.5, 0.25, 0.75, 0.5, 0.25, 0.5],       #BRVO
            [0.25, 0, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.5, 1, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.5],   #ODP
            [0.5, 0, 0.25, 0.25, 0.25, 0.5, 0.5, 0.5, 0.75, 0.25, 1, 0.5, 0.25, 0.25, 0.5, 0.25, 0.75, 0.75, 0.25, 0.5],        #CRVO
            [0.25, 0, 0.25, 0.25, 0.25, 0.75, 0.75, 0.5, 0.25, 0.25, 0.5, 1, 0.25, 0.25, 0.25, 0.25, 0.5, 0.5, 0.25, 0.5],      #CNV
            [0.25, 0, 0.5, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 1, 0.75, 0.25, 0.25, 0.25, 0.25, 0.75, 0.5],   #RS
            [0.5, 0, 0.5, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.75, 1, 0.25, 0.25, 0.25, 0.25, 0.5, 0.5],     #ODE
            [0.75, 0, 0.5, 0.25, 0.25, 0.5, 0.5, 0.5, 0.5, 0.25, 0.5, 0.25, 0.25, 0.25, 1, 0.25, 0.5, 0.5, 0.25, 0.5],          #LS
            [0.25, 0, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 1, 0.25, 0.25, 0.25, 0.5],  #CSR
            [0.75, 0, 0.25, 0.5, 0.25, 0.75, 0.5, 0.5, 0.75, 0.25, 0.75, 0.5, 0.25, 0.25, 0.5, 0.25, 1, 0.75, 0.25, 0.5],       #HTR
            [0.75, 0, 0.25, 0.25, 0.25, 0.5, 0.5, 0.25, 0.5, 0.25, 0.75, 0.5, 0.25, 0.25, 0.5, 0.25, 0.75, 1, 0.5, 0.5],        #ASR
            [0.25, 0, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.75, 0.5, 0.25, 0.25, 0.25, 0.5, 1, 0.5],    #CRS
            [0.5, 0, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 1],                   #OTHER
            ])

# ODIR Dataset (8 classes)
ODIR_FDCM = torch.tensor([
            [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],       # normal retina
            [0.0, 1.0, 0.5, 0.25, 0.5, 0.75, 0.5, 0.5],     # diabetic retinopathy
            [0.0, 0.5, 1.0, 0.25, 0.5, 0.75, 0.5, 0.5],     # glaucoma
            [0.0, 0.25, 0.25, 1.0, 0.5, 0.5, 0.25, 0.5],    # cataract
            [0.0, 0.5, 0.5, 0.5, 1.0, 0.75, 0.5, 0.5],      # age-related macular degeneration
            [0.0, 0.75, 0.75, 0.5, 0.75, 1.0, 0.5, 0.5],    # hypertensive retinopathy
            [0.0, 0.5, 0.5, 0.25, 0.5, 0.5, 1.0, 0.5],      # myopia
            [0.0, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 1.0]        # other diseases
            ])